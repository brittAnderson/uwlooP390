<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Britt Anderson">

<title>Psych 390</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="syllabusBrittPSYCH390W2025_files/libs/clipboard/clipboard.min.js"></script>
<script src="syllabusBrittPSYCH390W2025_files/libs/quarto-html/quarto.js"></script>
<script src="syllabusBrittPSYCH390W2025_files/libs/quarto-html/popper.min.js"></script>
<script src="syllabusBrittPSYCH390W2025_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="syllabusBrittPSYCH390W2025_files/libs/quarto-html/anchor.min.js"></script>
<link href="syllabusBrittPSYCH390W2025_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="syllabusBrittPSYCH390W2025_files/libs/quarto-html/quarto-syntax-highlighting-f23ab18612d661d7bd56dbc0c0fd3817.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="syllabusBrittPSYCH390W2025_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="syllabusBrittPSYCH390W2025_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="syllabusBrittPSYCH390W2025_files/libs/bootstrap/bootstrap-e19dc0c07aeef78048e587c3f1edba7a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="syllabusBrittPSYCH390W2025.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Psych 390</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Britt Anderson <a href="mailto:britt@uwaterloo.ca" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="brittlab.uwaterloo.ca">
            University of Waterloo
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>To learn how to approach the computer as a tool for facilitating research skills.</p>
<section id="skills-to-support" class="level2">
<h2 class="anchored" data-anchor-id="skills-to-support">Skills to support</h2>
<ol type="1">
<li>Finding, collecting, commentating, and integrating relevant research literature.</li>
<li>Sharing and tracking data, manuscripts, analyses, results, and a finished poster or manuscript</li>
<li>In support of the above how do you find, install, and maintain software?</li>
<li>Large data handling</li>
<li>Writing up your research</li>
</ol>
</section>
</section>
<section id="course-timeplace" class="level1">
<h1>Course Time/Place</h1>
<p>PSYCH 390 Thursday 14:30 — 17:30 <a href="https://maps.app.goo.gl/zp7p9FnLQX2vpSfx6">PHY</a> 313</p>
</section>
<section id="instructor" class="level1">
<h1>Instructor</h1>
<p>Britt Anderson, PhD &amp; MD</p>
<p><strong>Office:</strong> PAS 4039 <strong>email:</strong> <a href="mailto:britt@uwaterloo.ca">britt@uwaterloo.ca</a> <strong>Office Hours:</strong> by appointment</p>
</section>
<section id="topics-to-be-covered" class="level1">
<h1>Topics to be covered</h1>
<section id="bibliography-software-and-zettlekasten" class="level2">
<h2 class="anchored" data-anchor-id="bibliography-software-and-zettlekasten">Bibliography software and Zettlekasten</h2>
</section>
<section id="programming-language-choices-for-experiments" class="level2">
<h2 class="anchored" data-anchor-id="programming-language-choices-for-experiments">Programming language choices for experiments</h2>
</section>
<section id="data-storage" class="level2">
<h2 class="anchored" data-anchor-id="data-storage">Data Storage</h2>
<section id="data-sharing-big-data-data-re-use" class="level3">
<h3 class="anchored" data-anchor-id="data-sharing-big-data-data-re-use">Data sharing; Big Data; Data Re-use</h3>
</section>
</section>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<section id="statistical-programming" class="level3">
<h3 class="anchored" data-anchor-id="statistical-programming">Statistical programming</h3>
</section>
<section id="data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization">Data Visualization</h3>
</section>
</section>
<section id="research-dissemination" class="level2">
<h2 class="anchored" data-anchor-id="research-dissemination">Research dissemination</h2>
<section id="writing-and-sharing-reproducible-analyses-and-articles" class="level3">
<h3 class="anchored" data-anchor-id="writing-and-sharing-reproducible-analyses-and-articles">Writing and sharing reproducible analyses and articles</h3>
</section>
</section>
</section>
<section id="grades" class="level1">
<h1>Grades</h1>
<p>I know you are all concerned about grades, but I am not. It sometimes feels like University is a checklist: take the right number of courses and get the right numbers on your transcripts and you will win. But that is not the case. Success in your career depends on your being able to deploy what you have learned and being able to keep on learning. These meta-skills are the ones I am most interested in helping you progress with and there are no measurement tools that we can use in this course that will allow us to predict your future occupational success. The compromise is for me to emphasize and incentivize those practices that I have learned to be most correlated with professional success: persistence, self-learning, striving for excellence. That is why I try to grade less on what you produce than how you produce it. A spectacular fail may be worth more than a safe win at this stage of your career. That is the philosophy. How do we make this work in practice?</p>
<p>I will give you frequent small assignments to demonstrate that you are keeping up and working on the material. I will assess your profile in class: do you come, are your interactive, are you prepared, and are you collaborative; and I will provide a final project goal for you to try and stretch your wings and put in practice what you have learned.</p>
<p>My experience is that I don’t have to be a strict grader. The world is a far harder grader than I will ever be. You can easily find a way to get a good number in my class without learning a whole lot. That will be a very short term gain. I encourage you to be ambitious for yourselves. I hope that you will be more proud of what you have learned in this course than any particular pride in how it helps your GPA.</p>
<section id="details" class="level2">
<h2 class="anchored" data-anchor-id="details">Details</h2>
<ol type="1">
<li><p>Assignments - 60%</p></li>
<li><p>Participation - 10%</p></li>
<li><p>Final Project - 30%</p></li>
<li><p>Extra Credit Sona - 3%</p></li>
</ol>
</section>
<section id="sona-participation-and-research-experience-marks-information-and-guidelines" class="level2">
<h2 class="anchored" data-anchor-id="sona-participation-and-research-experience-marks-information-and-guidelines">Sona Participation and Research Experience Marks Information and Guidelines</h2>
<p>Experiential learning is considered an integral part of the undergraduate program in Psychology. Research participation is one example of this, article review is another.&nbsp;A number of undergraduate courses have been expanded to include opportunities for Psychology students to earn grades while gaining research experience.</p>
<p>Since experiential learning is highly valued in the Department of Psychology, students may earn a “Bonus” grade of up to 3%** in this course through research experience. Course work will make up 100% of the final mark and your SONA will add up to an additional 3% to this final grade.</p>
<p>The two options for earning research experience grades; participation in research through online remotely operated and In Lab studies, as well as article review; are described below. Students may complete any combination of these options to earn research experience grades. Credits will be permitted to be earned with half from online, and the other half (1.5) from In-lab or Remote Access studies.</p>
<section id="option-1-participation-in-psychology-research" class="level3">
<h3 class="anchored" data-anchor-id="option-1-participation-in-psychology-research">Option 1: Participation in Psychology Research</h3>
<p>Research participation is coordinated by the Research Experiences Group (REG). Psychology students may volunteer as research participants in remotely operated, In Lab and/or online (web-based) studies conducted by students and faculty in the Department of Psychology. Participation enables students to learn first-hand about psychology research and related concepts. Many students report that participation in research is both an educational and interesting experience. Please be assured that all Psychology studies have been reviewed and received ethics clearance through a University of Waterloo Research Ethics Board.&nbsp;</p>
<section id="how-to-earn-extra-marks-for-your-psychology-courses-this-term-by-participating-in-studies" class="level4">
<h4 class="anchored" data-anchor-id="how-to-earn-extra-marks-for-your-psychology-courses-this-term-by-participating-in-studies">How to earn extra marks for your Psychology course(s) this term by participating in studies</h4>
<ul>
<li>You will earn "credits" which will be converted to "marks" (1 credit = 1%)</li>
<li>You can schedule your studies using the "Sona" website.</li>
</ul>
<p>Educational focus of participation in research</p>
<p>To maximize the educational benefits of participating in research, students will receive feedback information following their participation in each study detailing the following elements:</p>
<ul>
<li>Purpose or objectives of the study</li>
<li>Dependent and independent variables</li>
<li>Expected results</li>
<li>References for at least two related research articles</li>
<li>Provisions to ensure confidentiality of data</li>
<li>Contact information of the researcher should the student have further questions about the study</li>
<li>Contact information for the Director of the Office of Research Ethics should the student wish to learn more about the general ethical issues surrounding research with human participants, or specific questions or concerns about the study in which s/he participated.</li>
</ul>
<p>Participation in remotely operated (counts as the same as in-lab) studies has increment values of 0.5 participation credits (grade percentage points) for each 30-minutes of participation. Participation in ONLINE studies is worth .25 credits for each 15-minutes of participation. Researchers will record student’s participation and at the end of the term the REG Coordinator will provide the course instructor with a credit report of the total credits earned by each student.</p>
<p><strong>How to participate?</strong></p>
<p>Study scheduling, participation and grade assignment is managed using the SONA online system. All students enrolled in this course have been set up with a SONA account.&nbsp; You must get started early in the term.</p>
<p>For instructions on how to log in to your SONA account and for a list of important dates and deadlines please, as soon as possible, go to:</p>
<p><a href="https://uwaterloo.ca/research-experiences-group/welcome-research-experiences-group-and-sona/sona-information">Participating/SONA information: How to log in to Sona and sign up for studies</a></p>
<p><a href="https://uwaterloo.ca/research-experiences-group/welcome-research-experiences-group-and-sona/sona-information">Please do not ask the Course Instructor or REG Coordinator for information unless you have first thoroughly read the information provided on this website.</a></p>
<p>More information about the REG program in general is available at:<br>
<a href="https://uwaterloo.ca/research-experiences-group/welcome-research-experiences-group-and-sona/sona-information">Sona Information on the REG Participants website</a> or you can check the <a href="https://uwaterloo.ca/research-experiences-group/sites/ca.research-experiences-group/files/uploads/files/sona_faq_for_fall_2019.pdf">Sona FAQ on the REG website homepage</a> for additional information.</p>
</section>
</section>
<section id="option-2-article-review-as-an-alternative-to-participation-in-research" class="level3">
<h3 class="anchored" data-anchor-id="option-2-article-review-as-an-alternative-to-participation-in-research">Option 2: Article Review as an alternative to participation in research</h3>
<p>Students are not required to participate in research, and not all students wish to do so. As an alternative, students may opt to gain research experience by writing short reviews (1½ to 2 pages) of research articles relevant to the course. The course instructor will specify a suitable source of articles for this course (i.e., scientific journals, newspapers, magazines, other printed media). <em>You must contact your TA to get approval for the article you have chosen before writing the review.</em> Each review article counts as one percentage point. To receive credit, you must follow specific guidelines. The article review must:</p>
<ul>
<li><strong>Be submitted before the</strong> <a href="http://www.quest.uwaterloo.ca/undergraduate/dates.html">last day of lectures</a><strong>. Late submissions will NOT be accepted under ANY circumstances.</strong></li>
<li>Be typed</li>
<li>Fully identify the title, author(s), source and date of the article.&nbsp;A copy of the article must be attached.</li>
<li>Identify the psychological concepts in the article and indicate the pages in the textbook that are applicable. Critically evaluate the application or treatment of those concepts in the article. If inappropriate or incorrect, identify the error and its implications for the validity of the article. You may find, for example, misleading headings, faulty research procedures, alternative explanations that are ignored, failures to distinguish factual findings from opinions, faulty statements of cause-effect relations, errors in reasoning, etc. Provide examples whenever possible.</li>
<li>Clearly evaluate the application or treatment of those concepts in the article.</li>
<li>Keep a copy of your review in the unlikely event we misplace the original.</li>
</ul>
</section>
</section>
</section>
<section id="boilerplate" class="level1">
<h1>Boilerplate</h1>
<section id="cost-of-learning-materials" class="level2">
<h2 class="anchored" data-anchor-id="cost-of-learning-materials">Cost of Learning Materials</h2>
<p>Students need to have access to a laptop for in course programming exercises. This does not need to be purchased for the course, but it does need to be available, and it is presumed that all students currently enrolled in advanced undergraduate studies have access to a computer. The cost is $0.00.</p>
<p>The computer must run a full operating system (OSX/Windows/Linux). Phones and tablets running iOS or Android will not be sufficient.</p>
</section>
<section id="academic-integrity" class="level2">
<h2 class="anchored" data-anchor-id="academic-integrity"><strong>Academic integrity</strong>:</h2>
<p>In order to maintain a culture of academic integrity, members of the University of Waterloo community are expected to promote honesty, trust, fairness, respect and responsibility. [Check <a href="https://uwaterloo.ca/academic-integrity/">the Office of Academic Integrity</a> for more information.</p>
</section>
<section id="grievance" class="level2">
<h2 class="anchored" data-anchor-id="grievance"><strong>Grievance:</strong></h2>
<p>A student who believes that a decision affecting some aspect of their university life has been unfair or unreasonable may have grounds for initiating a grievance. Read <a href="https://uwaterloo.ca/secretariat/node/75">Policy 70, Student Petitions and Grievances, Section 4</a>. When in doubt, please be certain to contact the department’s administrative assistant who will provide further assistance.</p>
</section>
<section id="discipline" class="level2">
<h2 class="anchored" data-anchor-id="discipline"><strong>Discipline:</strong></h2>
<p>A student is expected to know what constitutes academic integrity to avoid committing an academic offence, and to take responsibility for their&nbsp;actions. [Check <a href="https://uwaterloo.ca/academic-integrity/">the Office of Academic Integrity</a> for more information.] A student who is unsure whether an action constitutes an offence, or who needs help in learning how to avoid offences (e.g., plagiarism, cheating) or about “rules” for group work/collaboration should seek guidance from the course instructor, academic advisor, or the undergraduate associate dean. For information on categories of offences and types of penalties, students should refer to <a href="https://uwaterloo.ca/secretariat/node/72">Policy 71, Student Discipline</a>. For typical penalties, check <a href="https://uwaterloo.ca/secretariat/guidelines/guidelines-assessment-penalties">Guidelines for the Assessment of Penalties</a>.</p>
</section>
<section id="appeals" class="level2">
<h2 class="anchored" data-anchor-id="appeals"><strong>Appeals:</strong></h2>
<p>A decision made or penalty imposed under <a href="https://uwaterloo.ca/secretariat/node/75">Policy 70, Student Petitions and Grievances</a> (other than a petition) or <a href="https://uwaterloo.ca/secretariat/node/72">Policy 71, Student Discipline</a> may be appealed if there is a ground. A student who believes they have a&nbsp;ground for an appeal should refer to <a href="https://uwaterloo.ca/secretariat/policies-procedures-guidelines/policy-72">Policy 72, Student Appeals</a>.</p>
</section>
<section id="note-for-students-with-disabilities" class="level2">
<h2 class="anchored" data-anchor-id="note-for-students-with-disabilities"><strong>Note for students with disabilities:</strong></h2>
<p><a href="https://uwaterloo.ca/accessability-services/">AccessAbility Services</a>, located in Needles Hall, Room 1401, collaborates with all academic departments to arrange appropriate accommodations for students with disabilities without compromising the academic integrity of the curriculum. If you require academic accommodations to lessen the impact of your disability, please register with AccessAbility Services at the beginning of each academic term.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>